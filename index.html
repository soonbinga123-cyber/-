<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Slot Machine - í™•ë¥  ì¡°ì • + ë‹¹ì²¨ ì¹´ìš´íŠ¸</title>
  <style>
    :root{
      --bg:#08121a;
      --card:#0b1720;
      --accent:#f5c542;
      --muted:#9aa7b2;
      --danger:#ffbcbc;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      gap:18px;
      font-family: "Apple SD Gothic Neo","Noto Sans KR", Arial, sans-serif;
      background:linear-gradient(180deg,#07121a 0%, #0f2230 100%);
      color:#fff;
      padding:28px;
    }
    .card{
      background:linear-gradient(180deg,var(--card), #071018);
      padding:18px;
      border-radius:12px;
      box-shadow:0 6px 28px rgba(0,0,0,0.6);
      width:860px;
      max-width:96%;
      border:1px solid rgba(255,255,255,0.03);
    }
    h1{margin:0 0 8px; font-size:20px}
    .top-row{display:flex; gap:18px; align-items:flex-start;}
    #slotCanvas{
      background:#001217;
      border-radius:8px;
      border:4px solid #000;
      width:600px;
      height:200px;
      display:block;
    }
    .controls{
      display:flex;
      gap:12px;
      align-items:center;
      margin-top:8px;
      flex-wrap:wrap;
    }
    button{
      background:var(--accent);
      color:#111;
      border:none;
      padding:10px 14px;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 4px 8px rgba(0,0,0,0.4);
    }
    button:disabled{opacity:0.5; cursor:not-allowed}
    .info{color:var(--muted); font-size:13px}
    .sidebar{width:220px;}
    .prob-row{display:flex; gap:8px; align-items:center; margin-bottom:8px}
    .prob-row input[type="number"]{width:60px; padding:6px; border-radius:6px; border:1px solid #333; background:#07131a; color:#fff}
    .prob-row input[type="range"]{flex:1}
    .prob-label{width:36px; text-align:center}
    .stats{margin-top:12px; font-size:14px; color:var(--muted)}
    .small{font-size:12px; color:#9aa7b2; margin-top:6px}
    /* modal overlay */
    .overlay{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); z-index:999}
    .overlay.active{display:flex}
    .modal{background:#fff; color:#111; width:520px; border-radius:10px; padding:18px; text-align:center}
    .danger{background:var(--danger); padding:10px; border-radius:8px; color:#8a1212; font-weight:700; margin:8px 0}
    input[type="password"]{padding:10px; border-radius:8px; border:1px solid #ccc; font-size:16px; width:160px}
    .flex-col{display:flex; flex-direction:column; gap:8px}
    .footer{margin-top:12px; font-size:13px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ° ìŠ¬ë¡¯ë¨¸ì‹  â€” í™•ë¥  ì¡°ì • & ë‹¹ì²¨ ì¹´ìš´íŠ¸</h1>
    <div class="top-row">
      <div>
        <canvas id="slotCanvas" width="600" height="200"></canvas>

        <div class="controls">
          <button id="spinBtn">Spin</button>
          <button id="resetCountBtn" title="ìŠ¤í•€ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”">Reset Count</button>
          <div class="info" id="countInfo">ì—°ì† ìŠ¤í•€: 0</div>
        </div>

        <div class="footer small">ìŠ¤í˜ì´ìŠ¤ë°”ë¡œë„ ìŠ¤í•€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      </div>

      <div class="sidebar">
        <div style="font-weight:700; margin-bottom:8px">ì‹¬ë³¼ í™•ë¥  ì¡°ì •</div>

        <div id="probList"></div>

        <div style="display:flex; gap:8px; margin-top:10px;">
          <button id="normalizeBtn">ì •ê·œí™” (ìë™)</button>
          <button id="randomizeBtn">ëœë¤ ì´ˆê¸°í™”</button>
        </div>

        <div class="stats">
          <div>ì´ ìŠ¤í•€: <span id="totalSpins">0</span></div>
          <div>ì­íŒŸ(ëª¨ë‘ ë™ì¼) íšŸìˆ˜: <span id="jackpotCount">0</span></div>
          <div>í˜„ì¬ í™•ë¥  í•©ê³„: <span id="probSum">0</span></div>
        </div>

        <div class="small">ê° ì‹¬ë³¼ì— 0 ì´ìƒì˜ ê°€ì¤‘ì¹˜ ì…ë ¥ (0 ê°€ëŠ¥). ë¹„ìœ¨ì€ ìë™ìœ¼ë¡œ ê³„ì‚°ë˜ì–´ ì ìš©ë©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="small" style="margin-top:12px;">
      ì—°ì†ìœ¼ë¡œ 3ë²ˆ ìŠ¤í•€í•˜ë©´ ê²Œì„ì´ ì ê¸°ê³  "ë„ë°•ì€ ìœ„í—˜í•˜ë‹¤"ê°€ í‘œì‹œë©ë‹ˆë‹¤. ì ê¹€ í•´ì œëŠ” ë¹„ë°€ë²ˆí˜¸ í•„ìš” (ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸: <strong>0000</strong>).
    </div>
  </div>

  <!-- ì ê¸ˆ ëª¨ë‹¬ -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h2 id="modalTitle">ë„ë°•ì€ ìœ„í—˜í•©ë‹ˆë‹¤</h2>
      <div class="danger">ë„ë°•ì€ ìœ„í—˜í•˜ë‹¤</div>
      <div>ê³„ì†í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
      <div style="margin-top:10px;">
        <input id="pwInput" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
        <button id="unlockBtn">í™•ì¸</button>
      </div>
      <div class="small" style="margin-top:8px;">ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ëŠ” ì½”ë“œ ìƒë‹¨ì˜ UNLOCK_PASSWORD ê°’ì…ë‹ˆë‹¤.</div>
    </div>
  </div>

  <script>
    /*****************************************
     * ìŠ¬ë¡¯ë¨¸ì‹ : í™•ë¥ (ê°€ì¤‘ì¹˜) ì¡°ì • + ë‹¹ì²¨ ì¹´ìš´íŠ¸
     *****************************************/
    const UNLOCK_PASSWORD = "0000"; // í•„ìš”ì‹œ ë³€ê²½

    // ì‹¬ë³¼ & ì´ˆê¸° ê°€ì¤‘ì¹˜
    const symbols = ["ğŸ’","ğŸ””","ğŸ’","ğŸ‹","7ï¸âƒ£","â­"];
    // ê¸°ë³¸ ê°€ì¤‘ì¹˜ (ëª¨ë‘ ë™ì¼)
    let weights = Array(symbols.length).fill(1);

    // ìƒíƒœ ë³€ìˆ˜
    let totalSpins = 0;
    let jackpotCount = 0;
    let consecutiveSpins = 0;
    let locked = false;

    // Canvas
    const canvas = document.getElementById("slotCanvas");
    const ctx = canvas.getContext("2d");
    const numSlots = 3;
    const slotWidth = canvas.width / numSlots;
    let slotPositions = [0,0,0];
    let spinning = [false,false,false];
    let spinStartTime = [0,0,0];
    let targetResult = [0,0,0];

    // UI ìš”ì†Œ
    const spinBtn = document.getElementById("spinBtn");
    const resetCountBtn = document.getElementById("resetCountBtn");
    const countInfo = document.getElementById("countInfo");
    const probListDiv = document.getElementById("probList");
    const normalizeBtn = document.getElementById("normalizeBtn");
    const randomizeBtn = document.getElementById("randomizeBtn");
    const totalSpinsEl = document.getElementById("totalSpins");
    const jackpotCountEl = document.getElementById("jackpotCount");
    const probSumEl = document.getElementById("probSum");

    // modal
    const overlay = document.getElementById("overlay");
    const pwInput = document.getElementById("pwInput");
    const unlockBtn = document.getElementById("unlockBtn");

    // --- ê·¸ë¦¬ê¸° ---
    function drawSlots(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "#04121a";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.font = "80px serif";

      for(let i=0;i<numSlots;i++){
        const xCenter = i*slotWidth + slotWidth/2;
        const yCenter = canvas.height/2;
        let idx = ((Math.floor(slotPositions[i]) % symbols.length) + symbols.length) % symbols.length;
        ctx.fillStyle = "#fff";
        ctx.fillText(symbols[idx], xCenter, yCenter);
      }
    }

    // --- ì• ë‹ˆë©”ì´ì…˜ ---
    function animate(){
      let anySpinning = false;
      for(let i=0;i<numSlots;i++){
        if(spinning[i]){
          anySpinning = true;
          const elapsed = Date.now() - spinStartTime[i];
          const duration = 1600 + i*450;
          if(elapsed < duration){
            slotPositions[i] += 0.4 + (1 - elapsed/duration) * 7;
          } else {
            spinning[i] = false;
            slotPositions[i] = targetResult[i];
          }
        }
      }

      drawSlots();

      if(anySpinning){
        requestAnimationFrame(animate);
      } else {
        // ë©ˆì¶˜ í›„ ì²´í¬
        handleSpinEnd();
      }
    }

    function handleSpinEnd(){
      // ìŠ¤í•€ ì¹´ìš´íŠ¸ ì¦ê°€(ì´ ìŠ¤í•€)
      totalSpins++;
      totalSpinsEl.textContent = totalSpins;

      // ë‹¹ì²¨ ì²´í¬ (ëª¨ë‘ ë™ì¼)
      if(targetResult[0] === targetResult[1] && targetResult[1] === targetResult[2]){
        jackpotCount++;
        jackpotCountEl.textContent = jackpotCount;
        setTimeout(()=> alert("ğŸ‰ Jackpot!"), 60);
      }
    }

    // --- í™•ë¥ (ê°€ì¤‘ì¹˜)ì— ë”°ë¥¸ ëœë¤ ì„ íƒ ---
    function weightedRandomIndex(){
      const sum = weights.reduce((a,b)=> a + b, 0);
      if(sum <= 0){
        // ëª¨ë“  ê°€ì¤‘ì¹˜ê°€ 0ì´ë©´ ê· ë“± ì„ íƒ
        return Math.floor(Math.random() * weights.length);
      }
      const r = Math.random() * sum;
      let acc = 0;
      for(let i=0;i<weights.length;i++){
        acc += weights[i];
        if(r < acc) return i;
      }
      // ì•ˆì „ì¥ì¹˜
      return weights.length - 1;
    }

    function getRandomResult(){
      // ê° ë¦´ ë…ë¦½ì ìœ¼ë¡œ ê°€ì¤‘ì¹˜ì— ë”°ë¼ ì„ íƒ
      return [
        weightedRandomIndex(),
        weightedRandomIndex(),
        weightedRandomIndex()
      ];
    }

    // --- ìŠ¤í•€ ì‹œì‘ ---
    function startSpinFromUser(){
      if(locked) return;

      targetResult = getRandomResult();
      for(let i=0;i<numSlots;i++){
        spinning[i] = true;
        spinStartTime[i] = Date.now() + i*50;
      }
      animate();

      consecutiveSpins++;
      updateCountInfo();
      if(consecutiveSpins >= 3){
        lockGame();
      }
    }

    function updateCountInfo(){
      countInfo.textContent = `ì—°ì† ìŠ¤í•€: ${consecutiveSpins}`;
    }

    function lockGame(){
      locked = true;
      spinBtn.disabled = true;
      showLockModal();
    }

    function unlockGame(){
      locked = false;
      consecutiveSpins = 0;
      updateCountInfo();
      spinBtn.disabled = false;
      hideLockModal();
      pwInput.value = "";
    }

    // --- UI: í™•ë¥  ì»¨íŠ¸ë¡¤ ìƒì„± ---
    function renderProbControls(){
      probListDiv.innerHTML = "";
      for(let i=0;i<symbols.length;i++){
        const row = document.createElement("div");
        row.className = "prob-row";

        const label = document.createElement("div");
        label.className = "prob-label";
        label.textContent = symbols[i];

        const range = document.createElement("input");
        range.type = "range";
        range.min = 0;
        range.max = 100;
        range.step = 1;
        range.value = weights[i] * 10; // ë‚´ë¶€ì ìœ¼ë¡œ í‘œì‹œìš©
        range.dataset.index = i;

        const num = document.createElement("input");
        num.type = "number";
        num.min = 0;
        num.step = 1;
        num.value = weights[i];

        const pct = document.createElement("div");
        pct.style.width = "56px";
        pct.style.textAlign = "right";
        pct.style.fontSize = "13px";
        pct.style.color = "var(--muted)";

        // ë™ê¸°í™”
        function syncFromRange(){
          const idx = Number(range.dataset.index);
          const val = Math.max(0, Number(range.value));
          // rangeëŠ” 0..100 -> ê°€ì¤‘ì¹˜ë¡œ ë³€í™˜ (ì—¬ê¸°ì„  0..10)
          const w = Math.round(val / 10);
          weights[idx] = w;
          num.value = w;
          updateProbDisplay();
        }
        function syncFromNum(){
          const idx = Number(range.dataset.index);
          let val = Number(num.value);
          if(isNaN(val) || val < 0) val = 0;
          weights[idx] = Math.round(val);
          range.value = weights[idx] * 10;
          updateProbDisplay();
        }

        range.addEventListener("input", syncFromRange);
        num.addEventListener("change", syncFromNum);

        row.appendChild(label);
        row.appendChild(range);
        row.appendChild(num);
        row.appendChild(pct);

        probListDiv.appendChild(row);
      }

      updateProbDisplay();
    }

    function updateProbDisplay(){
      const sum = weights.reduce((a,b)=> a + b, 0);
      probSumEl.textContent = sum.toFixed(0);

      // update each pct text (iterate children)
      const rows = probListDiv.querySelectorAll(".prob-row");
      rows.forEach((row, idx) => {
        const pctDiv = row.querySelector("div:last-child");
        let p = 0;
        if(sum > 0) p = (weights[idx] / sum) * 100;
        pctDiv.textContent = p.toFixed(1) + "%";
      });
    }

    // ì •ê·œí™”(ìë™): ê°€ì¤‘ì¹˜ë“¤ì„ í•©ì´ 100ì´ ë˜ê²Œ ì¬ìŠ¤ì¼€ì¼ - ì—¬ê¸°ì„œëŠ” ë‚´ë¶€ ì •ìˆ˜ ê°€ì¤‘ì¹˜ë¡œ ìœ ì§€
    function normalizeWeights(){
      const sum = weights.reduce((a,b)=> a + b, 0);
      if(sum <= 0){
        // ì „ë¶€ 0ì´ë©´ ê· ë“± ê°€ì¤‘ì¹˜ 1ë¡œ ë³€ê²½
        weights = Array(weights.length).fill(1);
      } else {
        // ë¹„ìœ¨ ìœ ì§€í•˜ë˜ ìµœì†Œ 1ë¡œ ë³´ì •í•˜ì—¬ ì •ìˆ˜í™”
        // ëª©í‘œ: ê°€ì¤‘ì¹˜ë“¤ì„ ì†Œìˆ˜ë¡œ ìœ ì§€í•˜ëŠ” ëŒ€ì‹  ê°„ë‹¨íˆ ë¹„ìœ¨ì„ ë³´ì •
        const normalized = weights.map(w => w / sum);
        // ìŠ¤ì¼€ì¼í•˜ì—¬ ì •ìˆ˜ë¡œ ë§Œë“¤ê¸° (ì´í•© 100 -> ê°€ì‹œì ìœ¼ë¡œ ë³´ê¸° ì¢‹ìŒ)
        const scaled = normalized.map(v => Math.max(0, Math.round(v * 100)));
        // ë³´ì •: í•©ì´ 0 ë˜ëŠ” !=100 ì´ë©´ ë§ˆì§€ë§‰ ì‹¬ë³¼ì— ë‚˜ë¨¸ì§€ ì¶”ê°€
        let s = scaled.reduce((a,b)=>a+b,0);
        if(s === 0){
          for(let i=0;i<scaled.length;i++) scaled[i] = 1;
          s = scaled.reduce((a,b)=>a+b,0);
        }
        if(s !== 100){
          scaled[scaled.length - 1] += (100 - s);
        }
        // ë‚´ë¶€ ê°€ì¤‘ì¹˜ëŠ” scaled/10 (ê°€ë…ì„±), ìµœì†Œ 0
        weights = scaled.map(v => Math.max(0, Math.round(v/10)));
        // ë³´ì •: ë§Œì•½ ëª¨ë‘ 0ì´ë©´ 1ë¡œ
        if(weights.every(w => w === 0)){
          weights = Array(weights.length).fill(1);
        }
      }
      renderProbControls();
    }

    function randomizeWeights(){
      for(let i=0;i<weights.length;i++){
        weights[i] = Math.floor(Math.random() * 6); // 0..5
      }
      // ë³´ì •: ëª¨ë‘ 0ì´ë©´ 1
      if(weights.every(w => w === 0)) weights[0] = 1;
      renderProbControls();
    }

    // --- ì´ë²¤íŠ¸ ë°”ì¸ë”© ---
    spinBtn.addEventListener("click", () => {
      startSpinFromUser();
    });
    resetCountBtn.addEventListener("click", () => {
      consecutiveSpins = 0;
      locked = false;
      spinBtn.disabled = false;
      updateCountInfo();
      hideLockModal();
    });

    normalizeBtn.addEventListener("click", normalizeWeights);
    randomizeBtn.addEventListener("click", randomizeWeights);

    // modal actions
    function showLockModal(){
      overlay.classList.add("active");
      setTimeout(()=> pwInput.focus(), 200);
    }
    function hideLockModal(){
      overlay.classList.remove("active");
    }

    unlockBtn.addEventListener("click", ()=>{
      const v = pwInput.value;
      if(v === UNLOCK_PASSWORD){
        unlockGame();
      } else {
        pwInput.style.animation = "shake 300ms";
        setTimeout(()=> pwInput.style.animation = "", 300);
      }
    });
    pwInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") unlockBtn.click();
    });

    // ìŠ¤í˜ì´ìŠ¤ë¡œ ìŠ¤í•€
    window.addEventListener("keydown", (e)=>{
      if(e.code === "Space"){
        e.preventDefault();
        spinBtn.click();
      }
    });

    // CSS ì• ë‹ˆë©”ì´ì…˜(í”ë“¤ë¦¼)
    const styleEl = document.createElement("style");
    styleEl.textContent = `
      @keyframes shake {
        0% { transform: translateX(0); }
        25% { transform: translateX(-6px); }
        50% { transform: translateX(6px); }
        75% { transform: translateX(-4px); }
        100% { transform: translateX(0); }
      }
    `;
    document.head.appendChild(styleEl);

    // ì´ˆê¸° ë Œë”ë§
    function init(){
      renderProbControls();
      drawSlots();
      updateCountInfo();
      totalSpinsEl.textContent = totalSpins;
      jackpotCountEl.textContent = jackpotCount;
      updateProbDisplay();
    }

    init();

    // Expose some functions for debugging in console (ì„ íƒ)
    window._slot = {
      weights, getRandomResult, startSpinFromUser, normalizeWeights, randomizeWeights
    };

  </script>
</body>
</html>
